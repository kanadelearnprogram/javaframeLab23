基于你提供的实验说明书、原型图（Image）以及前几轮的沟通，我为你整理了一份**教务管理模块**的详细需求分析文档。

这份文档将作为你后续代码开发（Controller/Service/Dao）和数据库建表的直接依据。

-----

# 实验二：教务管理模块详细需求分析

## 1\. 模块概述

本模块旨在实现高校教务管理中基础数据的维护与成绩的全流程管理。核心目标是实现从**基础数据批量导入**到**成绩录入计算**，再到**最终统计分析**的完整闭环。重点在于处理多表关联数据、复杂的参数传递以及自动化的业务逻辑计算。

## 2\. 涉及角色

* **教务管理员/教师**：主要操作者。拥有所有基础数据的增删改查权限，负责录入成绩、查看统计报表。
* **学生**（仅作为数据对象）：被管理的主体，关联班级与成绩。

-----

## 3\. 核心功能需求分解

### 3.1 基础数据管理 (CRUD & Batch)

此部分是系统的基石，要求必须支持**批量操作**以提高效率。

* **[F-01] 班级管理**
    * **录入：** 支持单条添加和批量导入（JSON数组形式）。
    * **信息：** 需包含班级名称（如：软件工程2301）、所属院系。
* **[F-02] 课程管理**
    * **权重设置（关键）：** 在添加课程时，必须定义该课程的评分规则。
        * `daily_ratio` (平时成绩占比，如 0.3)
        * `exam_ratio` (期末成绩占比，如 0.7)
        * *注：原型图中明确标识了“平时成绩 30% | 期末成绩 70%”，说明此比例应存储在数据库中。*
* **[F-03] 学生管理**
    * **关联：** 添加学生时必须选择所属班级（`class_id`）。
    * **批量添加：** 支持一次性导入多个学生信息（如：学号、姓名、性别、班级）。
    * **批量删除：** 界面上支持勾选多行数据，前端发送 ID 列表（如 `['2021001', '2021002']`），后端执行批量删除。

### 3.2 成绩管理 (核心业务)

此部分对应原型图中的“成绩录入”界面，是逻辑最复杂的模块。

* **[F-04] 成绩录入与修改**
    * **输入项：** 针对指定学生和课程，输入 `平时成绩` 和 `期末成绩`。
    * **交互方式：** 支持列表形式的“行内编辑”（Inline Edit），即在表格中直接输入分数，点击“保存”或失去焦点时触发更新。
* **[F-05] 成绩自动计算 (核心逻辑)**
    * **触发时机：** 当用户输入或修改平时/期末成绩时，系统后端自动触发计算。
    * **逻辑：**
        1.  读取该课程的权重设置（如 3:7）。
        2.  计算：`总评 = 平时 * 0.3 + 期末 * 0.7`。
        3.  判断：若 `总评 < 60`，标记 `is_pass = 0`，否则为 1。
        4.  *原型图细节*：原型中提到“重修成绩 \< 75”的限制。建议作为扩展需求：若学生状态为“重修”，且计算结果 \> 75，则强制修正为 75。
* **[F-06] 多维查询与排序**
    * **筛选条件：** 班级（下拉框）、课程（下拉框）、学生姓名（模糊查询）、学号（精确查询）。
    * **排序：** 点击表头可按 `总评成绩`、`学号` 进行升序/降序排列。
    * **分页：** 必须实现后端分页，避免一次加载所有数据。

### 3.3 统计分析 (数据处理)

* **[F-07] 不及格统计 (挂科分析)**
    * **维度：** 按“班级 + 课程”为单位进行统计。
    * **输出内容：**
        1.  不及格总人数。
        2.  **不及格学生名单**（要求将多个学生姓名拼接显示，例如：“张三、李四、王五”）。

-----

## 4\. 数据需求与表结构分析

基于需求，确定以下表结构及关键字段约束。

| 表名 | 实体 | 关键字段 | 业务约束/说明 |
| :--- | :--- | :--- | :--- |
| **Class** | 班级 | `class_id` (PK), `class_name` | 班级名唯一 |
| **Course** | 课程 | `course_id` (PK), `daily_ratio`, `exam_ratio` | **权重之和必须为 1.0** (需在代码逻辑中校验) |
| **Student**| 学生 | `student_id` (PK), `class_id` (FK) | 学号作为主键，不自增 |
| **Score** | 成绩 | `student_id` (FK), `course_id` (FK), `daily_score`, `exam_score`, `total_score`, `is_pass` | **(student\_id, course\_id) 需建立联合唯一索引**，防止同一学生同一门课有多条成绩 |

-----

## 5\. 接口参数与处理逻辑设计

实验要求“实现多个参数的传递与解析机制”，具体体现在以下 API 设计中：

### 5.1 复杂查询接口 (GET /api/score/list)

* **需求：** 实现多条件组合查询 + 分页。
* **参数设计 (Query Params)：**
    * `page`: 当前页码 (int, 默认1)
    * `limit`: 每页条数 (int, 默认10)
    * `classId`: 班级ID (可选)
    * `courseId`: 课程ID (可选)
    * `keyword`: 搜索关键字 (可选，用于匹配姓名或学号)
    * `sortField`: 排序字段 (如 'total\_score')
    * `sortOrder`: 排序方式 ('asc' 或 'desc')
* **后端处理：** 使用 MyBatis 的 `<if>` 动态 SQL 标签拼接查询条件。

### 5.2 批量操作接口 (POST /api/student/batch-add)

* **需求：** 接收 JSON 数组并批量插入。
* **参数设计 (Body)：**
  ```json
  [
    {"studentId": "2023001", "name": "张三", "classId": 101},
    {"studentId": "2023002", "name": "李四", "classId": 101}
  ]
  ```
* **后端处理：** `@RequestBody List<Student> list`，使用事务注解 `@Transactional` 确保原子性。

-----

## 6\. 界面交互流程 (基于原型图)

1.  **进入页面**：默认加载“成绩录入”Tab，显示筛选栏（班级、课程）。
2.  **执行筛选**：选择“23软件工程-1班”和“Java程序设计”，点击查询。
3.  **列表展示**：表格显示该班级所有学生的该门课成绩。
    * 若未录入，显示空白或默认值。
    * 若已录入，显示具体分数。
4.  **录入/修改**：
    * 用户点击“平时成绩”输入框，输入 `80`。
    * 用户点击“期末成绩”输入框，输入 `90`。
    * **前端实时反馈**（可选）：前端 JS 预计算总分展示 `87` (假设 3:7)。
5.  **提交保存**：
    * 点击“保存”按钮。
    * 发送请求 `POST /api/score/save`。
    * 后端重新计算总分并存库，返回最新数据。
    * 界面提示“保存成功”。
6.  **统计查看**：
    * 点击“不及格统计”按钮（或独立页面）。
    * 弹出模态框或跳转页面，显示：“本班本课程不及格人数：2人，名单：王五、赵六”。

-----

这份分析涵盖了从底层数据到前端交互的所有细节。你现在可以依据这份文档开始编写 **Java 实体类 (Entity)** 和 **数据库建表 SQL** 了。需要我为你生成对应的 SQL 语句吗？